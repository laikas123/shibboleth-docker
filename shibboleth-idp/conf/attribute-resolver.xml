<?xml version="1.0" encoding="UTF-8"?>
<AttributeResolver
        xmlns="urn:mace:shibboleth:2.0:resolver"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:resolver="urn:mace:shibboleth:2.0:resolver"
        xsi:schemaLocation="urn:mace:shibboleth:2.0:resolver http://shibboleth.net/schema/idp/shibboleth-attribute-resolver.xsd">

    <!-- ========================================== -->
    <!--      Attribute Definitions (Mapped to LDAP) -->
    <!-- ========================================== -->

    <!-- Map the "uid" attribute from LDAP -->
    <AttributeDefinition id="uid" xsi:type="Simple">
        <Dependency ref="myLDAP" />
        <InputDataConnector ref="myLDAP" attributeNames="uid" />
    </AttributeDefinition>

    <!-- Set eduPersonPrincipalName as "uid@ldap-local.screenpal.com" -->
    <AttributeDefinition id="eduPersonPrincipalName" xsi:type="Scoped" scope="ldap-local.screenpal.com">
        <Dependency ref="myLDAP" />
        <InputDataConnector ref="myLDAP" attributeNames="uid" />
    </AttributeDefinition>

    <!-- Map the "cn" attribute from LDAP (Full Name) -->
    <AttributeDefinition id="cn" xsi:type="Simple">
        <Dependency ref="myLDAP" />
        <InputDataConnector ref="myLDAP" attributeNames="cn" />
    </AttributeDefinition>

    <!-- Map the "givenname" (First Name) from LDAP -->
    <AttributeDefinition id="givenName" xsi:type="Simple">
        <Dependency ref="myLDAP" />
        <InputDataConnector ref="myLDAP" attributeNames="givenname" />
    </AttributeDefinition>

    <!-- Map the "sn" (Last Name) from LDAP -->
    <AttributeDefinition id="sn" xsi:type="Simple">
        <Dependency ref="myLDAP" />
        <InputDataConnector ref="myLDAP" attributeNames="sn" />
    </AttributeDefinition>

    <!-- Map the "gidnumber" (Group ID) from LDAP -->
    <AttributeDefinition id="gidNumber" xsi:type="Simple">
        <Dependency ref="myLDAP" />
        <InputDataConnector ref="myLDAP" attributeNames="gidnumber" />
    </AttributeDefinition>

    <!-- Map the "homedirectory" from LDAP -->
    <AttributeDefinition id="homeDirectory" xsi:type="Simple">
        <Dependency ref="myLDAP" />
        <InputDataConnector ref="myLDAP" attributeNames="homedirectory" />
    </AttributeDefinition>

    <!-- Map the "loginshell" from LDAP -->
    <AttributeDefinition id="loginShell" xsi:type="Simple">
        <Dependency ref="myLDAP" />
        <InputDataConnector ref="myLDAP" attributeNames="loginshell" />
    </AttributeDefinition>

    <!-- ========================================== -->
    <!--      LDAP Data Connector                   -->
    <!-- ========================================== -->

    <resolver:DataConnector id="myLDAP" xsi:type="LDAPDirectory"
                            ldapURL="ldap://sp-openldap:389"
                            baseDN="ou=Users,dc=ldap-local,dc=screenpal,dc=com"
                            principal="cn=admin,dc=ldap-local,dc=screenpal,dc=com"
                            principalCredential="adminpassword"
                            useStartTLS="false"
                            connectTimeout="PT3S"
                            responseTimeout="PT3S">

        <ConnectionPool minPoolSize="5" maxPoolSize="20" blockWaitTime="PT10S"/>

        <!-- Search LDAP by uid -->
        <FilterTemplate>
            <![CDATA[
            (|(uid=$resolutionContext.principal)(cn=$resolutionContext.principal)(mail=$resolutionContext.principal))
            ]]>
        </FilterTemplate>
    </resolver:DataConnector>

</AttributeResolver>
